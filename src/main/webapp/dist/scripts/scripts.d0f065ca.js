"use strict";angular.module("ecommApp",["LocalStorageModule","ui.router","ngResource","ngMessages","ngCookies","ui.select","ngSanitize","ngAnimate","ngDragDrop","pageslide-directive","ui.bootstrap"]).constant("ROLES",{sysadmin:"sysadmin"}).run(["$rootScope","$state","$window","Auth","Principal","Resource",function(a,b,c,d,e,f){f.getResource().then(function(b){a.resource=b}),a.$on("$stateChangeStart",function(b,c,f,g,h){a.toState=c,a.toStateParams=f;var i=e.isResolved();i&&d.identify()}),a.$on("$stateChangeSuccess",function(b,d,e,f,g){var h="EComm";a.previousStateName=f.name,a.previousStateParams=g,d.data.title&&(h=d.data.title),c.document.title=h}),a.back=function(){"activate"===a.previousStateName||null===b.get(a.previousStateName)?b.go("home"):b.go(a.previousStateName,a.previousStateParams)}}]).factory("authExpiredInterceptor",["$rootScope","$q","$injector",function(a,b,c){return{responseError:function(d){if(401===d.status&&void 0!==d.data.path&&-1===d.data.path.indexOf("/api/csrf")){var e=c.get("Auth"),f=c.get("$state"),g=a.toState,h=a.toStateParams;e.logout(),a.returnToState=g,a.returnToStateParams=h,f.go("login")}return b.reject(d)}}}]).config(["$httpProvider","$stateProvider","$urlRouterProvider","ROLES",function(a,b,c,d){a.interceptors.push("authExpiredInterceptor"),c.otherwise("/login"),b.state("site",{"abstract":!0,views:{"navbar@":{templateUrl:"views/navbar.html?"+new Date,controller:"NavbarController"}},resolve:{identify:["Auth",function(a){return a.identify()}]}}).state("login",{parent:"site",url:"/login",views:{"content@":{templateUrl:"views/login.html",controller:"LoginController"}},data:{roles:[],authorities:[]}}).state("dashboard",{parent:"site",url:"/dashboard",views:{"content@":{templateUrl:"views/dashboard.html"}},data:{roles:[d.sysadmin],authorities:[]}}).state("accessdenied",{parent:"site",url:"/accessdenied",views:{"content@":{templateUrl:"views/accessdenied.html"}},data:{roles:[],authorities:[]}}).state("user",{parent:"site",url:"/users",views:{"content@":{templateUrl:"views/system/user.html?"+new Date,controller:"UserController"}},data:{roles:[d.sysadmin],authorities:[]}}).state("user.operator",{url:"/user/:id",views:{"content@":{templateUrl:"views/system/user.operator.html?"+new Date,controller:"UserOperatorController"}},data:{roles:[d.sysadmin],authorities:[]}}).state("user.role",{url:"/roles",views:{"content@":{templateUrl:"views/system/user.role.html?"+new Date,controller:"RoleController"}},data:{roles:[d.sysadmin],authorities:[]}}).state("shop",{parent:"site",url:"/shops",views:{"content@":{templateUrl:"views/system/shop.html?"+new Date,controller:"ShopController"}},data:{roles:[d.sysadmin],authorities:[]}}).state("shop.operator",{url:"/shop/:id",views:{"content@":{templateUrl:"views/system/shop.operator.html?"+new Date,controller:"ShopOperatorController"}},data:{roles:[d.sysadmin],authorities:[]}}).state("product",{parent:"site",url:"/products",views:{"content@":{templateUrl:"views/product/product.html?"+new Date,controller:"ProductController"}},data:{roles:[d.sysadmin],authorities:[]}}).state("product.operator",{url:"/product/:id",views:{"content@":{templateUrl:"views/product/product.operator.html?"+new Date,controller:"ProductOperatorController"}},data:{roles:[d.sysadmin],authorities:[]}}).state("brand",{parent:"site",url:"/brands",views:{"content@":{templateUrl:"views/product/brand.html?"+new Date,controller:"BrandController"}},data:{roles:[d.sysadmin],authorities:[]}}).state("category",{parent:"site",url:"/categories",views:{"content@":{templateUrl:"views/product/category.html?"+new Date,controller:"CategoryController"}},data:{roles:[d.sysadmin],authorities:[]}}).state("madefrom",{parent:"site",url:"/madefroms",views:{"content@":{templateUrl:"views/product/madefrom.html?"+new Date,controller:"MadeFromController"}},data:{roles:[d.sysadmin],authorities:[]}}).state("warehouse",{parent:"site",url:"/warehouses",views:{"content@":{templateUrl:"views/inventory/warehouse.html?"+new Date,controller:"WarehouseController"}},data:{roles:[d.sysadmin],authorities:[]}}).state("warehouse.operator",{url:"/warehouse/:id",views:{"content@":{templateUrl:"views/inventory/warehouse.operator.html?"+new Date,controller:"WarehouseOperatorController"}},data:{roles:[d.sysadmin],authorities:[]}}).state("inventory",{parent:"site",url:"/inventories",views:{"content@":{templateUrl:"views/inventory/inventory.html?"+new Date,controller:"InventoryController"}},data:{roles:[d.sysadmin],authorities:[]}}).state("inventory.enter",{parent:"site",url:"/inventories/enter/:id",views:{"content@":{templateUrl:"views/inventory/inventory.enter.html?"+new Date,controller:"InventoryEnterController"}},data:{roles:[d.sysadmin],authorities:[]}}).state("inventory.out",{parent:"site",url:"/inventories/out/:id",views:{"content@":{templateUrl:"views/inventory/inventory.out.html?"+new Date,controller:"InventoryOutController"}},data:{roles:[d.sysadmin],authorities:[]}}).state("process",{parent:"site",url:"/processes",views:{"content@":{templateUrl:"views/process/process.html?"+new Date,controller:"ProcessController"}},data:{roles:[d.sysadmin],authorities:[]}})}]),angular.module("ecommApp").controller("NavbarController",["$rootScope","$scope","$state","Auth","Principal",function(a,b,c,d,e){a.user=e.get,b.isAuthenticated=e.isAuthenticated,b.$state=c,b.logout=function(){d.logout().then(function(){c.go("login")})}}]),angular.module("ecommApp").controller("LoginController",["$rootScope","$scope","$state","Auth",function(a,b,c,d){b.error=!1,b.login=function(a){d.login(a).then(function(a){b.error=!1,c.go("dashboard")},function(a){b.error=!0})}}]),angular.module("ecommApp").controller("InventoryController",["$rootScope","$scope","Warehouse","Inventory",function(a,b,c,d){b.warehouses=[],b.warehouse={},b.products=[],c.getAll().then(function(a){b.warehouses=a,b.warehouse=angular.copy(a[0])}).then(function(){d.getAllByWarehouseId(b.warehouse.id).then(function(a){b.products=d.refresh(a)})}),b.changeWarehouse=function(){d.getAllByWarehouseId(b.warehouse.id).then(function(a){b.products=d.refresh(a)})}}]).controller("InventoryEnterController",["$rootScope","$scope","$state","$stateParams","Warehouse","Product","InventoryBatch","Utils",function(a,b,c,d,e,f,g,h){function i(){console.log(b.warehouse),1==b.warehouse.enablePosition?b.position.selected=b.warehouse.positions[0]:b.position.selected=void 0}b.warehouses=[],b.warehouse={},b.products=[],b.batch={operate:1,user:{id:a.user().id},operateTime:void 0,memo:"",items:[]},b.item={changedQuantity:1},b.product={selected:void 0},b.position={selected:void 0},b.changeWarehouse=function(){b.batch.items=[],angular.forEach(b.warehouses,function(a){return a.id==b.warehouse.id?void(b.warehouse=angular.copy(a)):void 0}),i(),b.batch.warehouseId=b.warehouse.id};var j=$("#sandbox-container input").datepicker({format:"yyyy-mm-dd",clearBtn:!0,language:"zh-CN",orientation:"top left",todayHighlight:!0}).on("changeDate",function(a){console.log(a.format()),a.date&&""!=a.date&&b.$apply(function(){b.item.expireDate=a.format()})});e.getAll().then(function(a){b.warehouses=a,d.id&&""!=d.id?angular.forEach(a,function(a){return a.id==d.id?void(b.warehouse=angular.copy(a)):void 0}):b.warehouse=angular.copy(a[0]),i(),b.batch.warehouseId=b.warehouse.id}).then(function(){f.getAll().then(function(a){b.products=a})}),b.add=function(){var c={product:b.product.selected,warehouseId:b.warehouse.id,position:b.position.selected,userId:a.user().id,changedQuantity:b.item.changedQuantity,expireDate:b.item.expireDate};b.batch.items.push(c),b.product.selected=void 0,i(),b.item={changedQuantity:1,expireDate:void 0},j.datepicker("clearDates")},b.remove=function(a){b.batch.items.splice(a,1)},b.save=function(){console.log(b.batch),g.save({},b.batch,function(a){console.log(a),c.go("inventory")})}}]).controller("InventoryOutController",["$rootScope","$scope","$state","$stateParams","Warehouse","Product","InventoryBatch","Utils","Inventory",function(a,b,c,d,e,f,g,h,i){function j(){b.product.selected?b.product.selected.positions.length>0?(console.log("有库位"),b.position.selected&&(b.quantity=b.position.selected.total,b.selectedBatch.selected&&(b.quantity=b.selectedBatch.selected.total))):(b.quantity=b.product.selected.total,b.selectedBatch.selected&&(b.quantity=b.selectedBatch.selected.total)):b.quantity=0}function k(){b.product.selected&&b.product.selected.positions.length>0?b.position.selected=b.product.selected.positions[0]:b.position.selected=void 0}function l(){b.item.changedQuantity=1}function m(){b.selectedBatch.selected=void 0}function n(){b.product.selected?b.product.selected.positions.length>0?b.position.selected?b.batches=b.position.selected.batches:b.batches=b.product.selected.positions[0].batches:b.batches=b.product.selected.batches:b.batches=[]}b.warehouses=[],b.warehouse={},b.products=[],b.batch={operate:2,user:{id:a.user().id},operateTime:void 0,memo:"",items:[]},b.quantity=0,b.item={changedQuantity:1},b.product={selected:void 0},b.position={selected:void 0},b.selectedBatch={selected:void 0},b.batches=[],e.getAll().then(function(a){b.warehouses=a,d.id&&""!=d.id?angular.forEach(a,function(a){return a.id==d.id?void(b.warehouse=angular.copy(a)):void 0}):b.warehouse=angular.copy(a[0]),k(),b.batch.warehouseId=b.warehouse.id}).then(function(){i.getAllByWarehouseId(b.warehouse.id).then(function(a){b.products=i.refresh(a)})}),b.changeWarehouse=function(){b.batch.items=[],angular.forEach(b.warehouses,function(a){return a.id==b.warehouse.id?void(b.warehouse=angular.copy(a)):void 0}),b.batch.warehouseId=b.warehouse.id,i.getAllByWarehouseId(b.warehouse.id).then(function(a){b.products=i.refresh(a),b.product.selected=void 0,m(),k(),n(),j(),l()})},b.changeProduct=function(){console.log("选择商品"),console.log(b.product.selected),m(),k(),n(),j(),l()},b.changePosition=function(){console.log("选择库位"),console.log(b.position.selected),m(),n(),j(),l()},b.changeBatch=function(){console.log("选择批次"),console.log(b.selectedBatch.selected),j(),l()},b.add=function(){var c={product:b.product.selected,warehouseId:b.warehouse.id,position:b.position.selected,userId:a.user().id,changedQuantity:b.item.changedQuantity,outBatch:b.selectedBatch.selected,$index:"t"+Date.parse(Date())};console.log(c),b.batch.items.push(c),b.products=i.refrechProducts(b.products,c,"add"),b.product.selected=void 0,m(),k(),n(),j(),l()},b.remove=function(a,c){console.log(c),b.batch.items.splice(a,1),b.products=i.refrechProducts(b.products,c,"remove"),b.product.selected=void 0,m(),k(),n(),j(),l()},b.save=function(){console.log(b.batch),g.save({},b.batch,function(a){console.log(a),c.go("inventory")})}}]),angular.module("ecommApp").controller("WarehouseController",["$rootScope","$scope","Warehouse","Utils",function(a,b,c,d){b.totalPagesList=[],b.pageSize=20,c.get({page:0,size:b.pageSize},function(a){console.log(a),b.page=a,b.totalPagesList=d.setTotalPagesList(a)}),b.turnPage=function(a){a>-1&&a<b.page.totalPages&&c.get({page:a,size:b.pageSize},function(a){b.page=a,b.totalPagesList=d.setTotalPagesList(a)})},b.positionsModal=function(a){b.positions=a.positions,$("#positionsModal").modal("show")},b.savePositions=function(a){console.log(a),c.savePositions(a).then(function(){$("#positionsModal").modal("hide"),b.positions=[]},function(a){console.log(a)})}}]).controller("WarehouseOperatorController",["$rootScope","$scope","$state","$stateParams","Warehouse",function(a,b,c,d,e){b.warehouse={},b.action="create",d.id&&""!==d.id&&(b.action="update",e.get({id:d.id},{},function(a){b.warehouse=a,console.log(a)})),b.save=function(a){console.log(a),a.enablePosition?a.positions=[{name:"A"},{name:"B"},{name:"C"},{name:"D"},{name:"E"},{name:"F"},{name:"G"},{name:"H"},{name:"I"},{name:"J"},{name:"K"},{name:"L"},{name:"M"},{name:"N"},{name:"O"},{name:"P"},{name:"Q"},{name:"R"},{name:"S"},{name:"T"},{name:"U"},{name:"V"},{name:"W"},{name:"X"},{name:"Y"},{name:"Z"}]:a.positions=[],e.save({},a,function(a){c.go("warehouse")},function(a){console.log(a)})},b.remove=function(){e.remove({id:d.id},{},function(a){c.go("warehouse")},function(a){console.log(a)})}}]),angular.module("ecommApp").controller("ProcessController",["$scope","$timeout","Process","ProcessStep",function(a,b,c,d){function e(b){if(b.type=a.types[b.type-1],b.objectType=a.objectTypes[b.objectType-1],null!=b.defaultStepId)for(var c=0,d=b.steps.length;d>c;c++){var e=b.steps[c];if(b.defaultStepId==e.id){b.defaultStep=angular.copy(e);break}}b.hideWhenComplete=a.isorno[b.hideWhenComplete?0:1]}function f(a){a.type=a.type.value,a.objectType=a.objectType.value,a.defaultStepId=a.defaultStep&&a.defaultStep.id,a.defaultStepName=a.defaultStep&&a.defaultStep.name,a.hideWhenComplete=a.hideWhenComplete.value}var g={type:{label:"线性流程",value:1},defaultStep:void 0,hideWhenComplete:{label:"否",value:!1},steps:[],deleted:!1,editable:!0},h={id:null,processId:null,name:"",sequence:0,type:1,$index:"t"+Date.parse(Date()),editable:!0};g.steps.push(angular.copy(h)),a.processes=[],a.types=[{label:"线性流程",value:1},{label:"开关流程",value:2}],a.objectTypes=[{label:"订单",value:1},{label:"商品",value:2},{label:"库存",value:3},{label:"采购",value:4}],a.isorno=[{label:"是",value:!0},{label:"否",value:!1}],c.getAll({deleted:!1}).then(function(b){console.log("Process.getAll():"),console.log(b),a.processes=b,angular.forEach(a.processes,function(a){e(a)})}),a.addProcess=function(){a.processes.unshift(angular.copy(g))},a.updateProcess=function(a,b){a.editable=!0},a.saveProcess=function(b,d,g){console.log("saveProcess:"),console.log(b),f(b),c.save({},b).$promise.then(function(b){console.log("saveProcess complete:"),angular.forEach(b.steps,function(a){a.processId=b.id}),console.log(b),d.$setPristine(),e(b),a.processes[g]=angular.copy(b),console.log("$scope.processes:"),console.log(a.processes)})};var i;a.showRemoveProcess=function(a,b){i=a,i.$index=b,$("#processDeleteModal").modal("show")},a.removeProcess=function(){i.id?(f(i),i.deleted=!0,c.save({},i).$promise.then(function(b){a.processes.splice(i.$index,1),$("#processDeleteModal").modal("hide"),i=void 0})):(a.processes.splice(i.$index,1),$("#processDeleteModal").modal("hide"),i=void 0)},a.addStep=function(a,b,c){h.$index="t"+c+Date.parse(Date()),a.steps.push(angular.copy(h)),a.steps=d.refresh(a.steps)},a.removeStep=function(a,b,c){var e=a.steps.length;1!=e&&(a.defaultStep=void 0,a.steps.splice(c,1),a.steps=d.refresh(a.steps))},a.drop=function(a,b,c){c.steps=d.refresh(c.steps),console.log("drop:"),console.log(c.steps)}}]),angular.module("ecommApp").controller("ProductController",["$scope","Product","Utils","Process","ObjectProcess",function(a,b,c,d,e){function f(b){angular.forEach(b,function(b){angular.forEach(b.steps,function(c){c.processName=b.name,a.status.push(c)})}),console.log("$scope.status:"),console.log(a.status)}function g(a){var b=[];return angular.forEach(a,function(a){b.push(a.id)}),b}a.template={process:{url:"views/product/product.process.html?"+new Date},status:{url:"views/product/product.status.html?"+new Date}},a.totalPagesList=[],a.pageSize=20,a.product={sku:"",name:""},a.processes=[],a.status=[],a.selected={status:[]},a.popover={url:"process-tmpl.html"},a.processSlideChecked=!1,a.statusSlideChecked=!1,a.processProduct=void 0,b.get({page:0,size:a.pageSize,sort:["name"]}).$promise.then(function(b){console.clear(),console.log("page:"),console.log(b),a.page=b,a.totalPagesList=c.setTotalPagesList(b)}).then(function(){d.getAll({deleted:!1,objectType:2}).then(function(b){console.log("Process.getAll:"),console.log(b),a.processes=b,f(b)})}),a.turnPage=function(d){console.clear(),console.log("turnPage:"),console.log(a.product),d>-1&&d<a.page.totalPages&&b.get({page:d,size:a.pageSize,sort:["name"],sku:a.product.sku,name:a.product.name,status:g(a.selected.status)},function(b){a.page=b,a.totalPagesList=c.setTotalPagesList(b)})},a.search=function(){console.clear(),console.log("search:"),console.log(a.product),b.get({page:0,size:a.pageSize,sort:["name"],sku:a.product.sku,name:a.product.name,status:g(a.selected.status)},function(b){a.page=b,a.totalPagesList=c.setTotalPagesList(b)})},a.reset=function(){console.clear(),console.log("reset:"),a.product={sku:"",name:""},a.selected.status.length=0,console.log(a.product),b.get({page:0,size:a.pageSize,sort:["name"]},function(b){a.page=b,a.totalPagesList=c.setTotalPagesList(b)})},a.colseStatusSlide=function(){a.statusSlideChecked=!1},a.loadStatus=function(){a.statusSlideChecked=!0},a.selectState=function(b){if(b.selected&&1==b.selected){b.selected=!1;for(var c=0,d=a.selected.status.length;d>c;c++)if(a.selected.status[c].id==b.id){a.selected.status.splice(c,1);break}}else b.selected=!0,a.selected.status.push(b);console.log("$scope.selectState():"),console.log(a.selected.status)},a.colseProcessSlide=function(){a.processSlideChecked=!1,a.processProduct&&(a.processProduct.active=!1)},a.loadProcesses=function(b){console.log(b),a.processSlideChecked=!0,a.processProduct=b,a.processProduct.active=!0},a.updateStep=function(b){console.log("updateStep:"),a.processProduct=b},a.saveUpdateStep=function(b,c){console.log("saveUpdateStep:"),b.step.id=c,console.log(b),e.save({},b,function(b){e.getAll({objectId:b.objectId}).then(function(b){console.log("refresh Processes:"),console.log(b),a.processProduct.processes=angular.copy(b)})})}}]).controller("ProductProcessController",["$scope","$filter","Process","ObjectProcess",function(a,b,c,d){a.applyProcess=function(c){var e={objectId:a.processProduct.id,objectType:2,process:{id:c.id}};c.steps=b("orderBy")(c.steps,"sequence"),c.defaultStepId?e.step={id:c.defaultStepId}:e.step={id:c.steps[0].id},d.save({},e).$promise.then(function(a){return a}).then(function(b){d.getAll({objectId:b.objectId}).then(function(b){console.log("refresh Processes:"),console.log(b),a.processProduct.processes=angular.copy(b),a.colseProcessSlide()})})},a.removeProcess=function(b){for(var c=a.processProduct.processes,e=0,f=c.length;f>e;e++){var g=c[e];if(b.id==g.process.id){d.remove({id:g.id},{},function(){d.getAll({objectId:g.objectId}).then(function(b){console.log("refresh Processes:"),console.log(b),a.processProduct.processes=angular.copy(b),a.colseProcessSlide()})});break}}},a.forObjectProcesses=function(b){if(a.processProduct){for(var c=a.processProduct.processes,d=0,e=c.length;e>d;d++){var f=c[d];if(f.process.id==b.processId)if(1==f.process.type){if(b.sequence>f.step.sequence)return!1;if(b.sequence<=f.step.sequence)return!0}else if(2==f.process.type){if(b.id==f.step.id)return!0;if(b.id!=f.step.id)return!1}}return!1}},a.appliedProcess=function(b){if(a.processProduct){for(var c=a.processProduct.processes,d=0,e=c.length;e>d;d++){var f=c[d];if(b.id==f.process.id)return!0}return!1}}}]).controller("ProductOperatorController",["$scope","$state","$stateParams","Product","Brand","Category","MadeFrom","Language","Currency","Tag",function(a,b,c,d,e,f,g,h,i,j){console.clear(),a.actionLabel=c.id&&""!=c.id?"编辑":"创建",a.template={info:{url:"views/product/product.operator.info.html?"+new Date,attr:{url:"views/product/product.operator.info.attr.html?"+new Date},price:{url:"views/product/product.operator.info.price.html?"+new Date},group:{url:"views/product/product.operator.info.group.html?"+new Date}},img:{url:"views/product/product.operator.img.html?"+new Date},multilanguage:{url:"views/product/product.operator.multilanguage.html?"+new Date},multicurrency:{url:"views/product/product.operator.multicurrency.html?"+new Date}},a.productTypes=[{label:"简单商品",value:0},{label:"组合商品",value:1}],a.brands=[],a.categories=[],a.madeFroms=[],a.languages=[],a.currencies=[],a.tags=[],a.members=[],a.product={weight:0,priceL1:0,priceL2:0,priceL3:0,priceL4:0,priceL5:0,priceL6:0,priceL7:0,priceL8:0,priceL9:0,priceL10:0,productType:a.productTypes[0],multiLanguages:[],multiCurrencies:[],members:[]},a.action="create",e.getAll().then(function(b){a.brands=b}).then(function(){return f.getAll().then(function(b){a.categories=b})}).then(function(){return g.getAll().then(function(b){a.madeFroms=b})}).then(function(){return h.getAll().then(function(b){a.languages=b})}).then(function(){return i.getAll().then(function(b){a.currencies=b})}).then(function(){return j.getAll().then(function(b){a.tags=b})}).then(function(){c.id&&""!=c.id&&(a.action="update",d.get({id:c.id},{}).$promise.then(function(b){return console.log("["+a.action+"] loading product"),console.log(b),b.productType=a.productTypes[b.productType],a.product=b,b}).then(function(b){a.title=b.productType.label,1==b.productType.value&&d.getAll({productType:0}).then(function(b){a.members=b})}))}),$("#productTabs a").click(function(a){a.preventDefault(),$(this).tab("show")})}]).controller("ProductInformationController",["$scope","$state","$stateParams","Product","ProductMember",function(a,b,c,d,e){var f={quantity:1};a.member=angular.copy(f);var g={totalPriceL1:0,totalPriceL2:0,totalPriceL3:0,totalPriceL4:0,totalPriceL5:0,totalPriceL6:0,totalPriceL7:0,totalPriceL8:0,totalPriceL9:0,totalPriceL10:0};a.sum=angular.copy(g),a.changeProductType=function(b,c){console.log("$item:"),console.log(b),1==b.value&&d.getAll({productType:0}).then(function(b){console.log("members:"),console.log(b),a.members=b})},a.save=function(c){console.log("["+a.action+"] save product"),c.productType=c.productType.value,0==c.productType&&(c.members.length=0),console.log(c),d.save({action:a.action},c,function(c){console.log("["+a.action+"] save product complete:"),console.log(c),b.go("product")})},a.saveMember=function(b,c){console.log("["+a.action+"] saveMember complete:"),console.log(c),a.product.members.push(angular.copy(c)),b.$setPristine(),a.member=angular.copy(f)},a.updateMember=function(a,b){console.log("updateMember:"),console.log(a),a.editable=!0},a.saveUpdateMember=function(b,c,d){console.log("["+a.action+"] saveUpdateMember complete:"),console.log(b),b.editable=!1,c.$setPristine()},a.removingMember=void 0,a.showRemoveMember=function(b,c){console.clear(),console.log("showRemoveMember $index: "+c),console.log(b),a.removingMember=b,a.removingMember.$index=c,$("#memberDeleteModal").modal("show")},a.removeMember=function(){console.clear(),console.log("removeMember:"),console.log(a.removingBrand),angular.isDefined(a.removingMember)&&(a.product.members.splice(a.removingMember.$index,1),a.removingBrand=void 0,$("#memberDeleteModal").modal("hide"))},a.$watch("product.productType",function(b){b?(a.title=b.label,0==b.value?a.passed=!0:1==b.value&&a.product.members.length>0?a.passed=!0:a.passed=!1):a.passed=!1}),a.$watch("product.members",function(b){a.product.productType&&1==a.product.productType.value&&(b.length>0?a.passed=!0:a.passed=!1),a.sum=angular.copy(g),angular.forEach(b,function(b){var c=parseInt(b.quantity);a.sum.totalPriceL1+=parseFloat(b.product.priceL1)*c,a.sum.totalPriceL2+=parseFloat(b.product.priceL2)*c,a.sum.totalPriceL3+=parseFloat(b.product.priceL3)*c,a.sum.totalPriceL4+=parseFloat(b.product.priceL4)*c,a.sum.totalPriceL5+=parseFloat(b.product.priceL5)*c,a.sum.totalPriceL6+=parseFloat(b.product.priceL6)*c,a.sum.totalPriceL7+=parseFloat(b.product.priceL7)*c,a.sum.totalPriceL8+=parseFloat(b.product.priceL8)*c,a.sum.totalPriceL9+=parseFloat(b.product.priceL9)*c,a.sum.totalPriceL10+=parseFloat(b.product.priceL10)*c}),a.product.priceL1=a.sum.totalPriceL1,a.product.priceL2=a.sum.totalPriceL2,a.product.priceL3=a.sum.totalPriceL3,a.product.priceL4=a.sum.totalPriceL4,a.product.priceL5=a.sum.totalPriceL5,a.product.priceL6=a.sum.totalPriceL6,a.product.priceL7=a.sum.totalPriceL7,a.product.priceL8=a.sum.totalPriceL8,a.product.priceL9=a.sum.totalPriceL9,a.product.priceL10=a.sum.totalPriceL10},!0)}]).controller("ProductImageController",["$scope","$cookies","$stateParams",function(a,b,c){var d=0;d=c.id&&""!=c.id?c.id:0,a.initImgFunction=function(){$('input[type="file"][name="image"]').on("change",function(){console.log(this.value.substring(this.value.lastIndexOf("\\")+1));var c=this.value.substring(this.value.lastIndexOf("\\")+1);0!=d&&(c=d+"-"+c);var e=this.id;$.ajax({url:"/api/products/image/upload/"+d+"/"+e,type:"POST",data:new FormData($("#"+this.id+"Form")[0]),enctype:"multipart/form-data",headers:{"X-XSRF-TOKEN":b.get("XSRF-TOKEN")},processData:!1,contentType:!1,cache:!1,success:function(){a.$apply(function(){a.product[e]=c})},error:function(){}})})}}]).controller("ProductMultiLanguageController",["$scope","$stateParams","ProductMultiLanguage",function(a,b,c){a.multiLanguage={},a.saveLanguage=function(d,e){console.clear(),console.log("["+a.action+"] saveLanguage:"),console.log(e),"create"==a.action?(console.log("["+a.action+"] saveLanguage complete:"),console.log(e),a.product.multiLanguages.push(angular.copy(e)),d.$setPristine(),a.multiLanguage={}):"update"==a.action&&(e.productId=b.id,c.save({},e,function(b){console.log("["+a.action+"] saveLanguage complete:"),console.log(b),a.product.multiLanguages.push(angular.copy(b)),d.$setPristine(),a.multiLanguage={}}))},a.updateLanguage=function(a,b){console.clear(),console.log("updateLanguage:"),console.log(a),a.editable=!0},a.saveUpdateLanguage=function(b,d,e){console.clear(),console.log("["+a.action+"] saveUpdateLanguage complete:"),"create"==a.action?(console.log(b),b.editable=!1,d.$setPristine()):"update"==a.action&&c.save({},b,function(){console.log(b),b.editable=!1,d.$setPristine()})},a.removingLanguage=void 0,a.showRemoveLanguage=function(b,c){console.clear(),console.log("showRemoveLanguage $index: "+c),console.log(b),a.removingLanguage=b,a.removingLanguage.$index=c,$("#mlDeleteModal").modal("show")},a.removeLanguage=function(){console.clear(),console.log("removeLanguage:"),console.log(a.removingLanguage),angular.isDefined(a.removingLanguage)&&("create"==a.action?(a.product.multiLanguages.splice(a.removingLanguage.$index,1),a.removingLanguage=void 0,$("#mlDeleteModal").modal("hide")):"update"==a.action&&c.remove({id:a.removingLanguage.id},{},function(){a.product.multiLanguages.splice(a.removingLanguage.$index,1),a.removingLanguage=void 0,$("#mlDeleteModal").modal("hide")}))}}]).controller("ProductMultiCurrencyController",["$scope","$stateParams","ProductMultiCurrency",function(a,b,c){var d={priceL1:0,priceL2:0,priceL3:0,priceL4:0,priceL5:0,priceL6:0,priceL7:0,priceL8:0,priceL9:0,priceL10:0};a.multiCurrency=angular.copy(d),a.saveCurrency=function(e,f){console.clear(),console.log("["+a.action+"] saveCurrency:"),console.log(f),"create"==a.action?(console.log("["+a.action+"] saveCurrency complete:"),console.log(f),a.product.multiCurrencies.push(angular.copy(f)),e.$setPristine(),a.multiCurrency=angular.copy(d)):"update"==a.action&&(f.productId=b.id,c.save({},f,function(b){console.log("["+a.action+"] saveCurrency complete:"),console.log(b),a.product.multiCurrencies.push(angular.copy(b)),e.$setPristine(),a.multiCurrency=d}))},a.updateCurrency=function(a,b){console.clear(),console.log("updateCurrency:"),console.log(a),a.editable=!0},a.saveUpdateCurrency=function(b,d){console.clear(),console.log("["+a.action+"] updateCurrency complete:"),"create"==a.action?(console.log(b),b.editable=!1):"update"==a.action&&c.save({},b,function(){console.log(b),b.editable=!1})},a.removingCurrency=void 0,a.showRemoveCurrency=function(b,c){console.clear(),console.log("showRemoveCurrency $index: "+c),console.log(b),a.removingCurrency=b,a.removingCurrency.$index=c,$("#mcDeleteModal").modal("show")},a.removeCurrency=function(){console.clear(),console.log("removeCurrency:"),console.log(a.removingCurrency),angular.isDefined(a.removingCurrency)&&("create"==a.action?(a.product.multiCurrencies.splice(a.removingCurrency.$index,1),a.removingCurrency=void 0,$("#mcDeleteModal").modal("hide")):"update"==a.action&&c.remove({id:a.removingCurrency.id},{},function(){a.product.multiCurrencies.splice(a.removingCurrency.$index,1),a.removingCurrency=void 0,$("#mcDeleteModal").modal("hide")}))}}]),angular.module("ecommApp").controller("BrandController",["$scope","Brand","Utils",function(a,b,c){function d(){b.get({page:0,size:a.pageSize,sort:["id,desc"]},function(b){console.clear(),console.log("page:"),console.log(b),a.page=b,a.totalPagesList=c.setTotalPagesList(b)})}a.totalPagesList=[],a.pageSize=20,a.brand={},d(),a.turnPage=function(d){d>-1&&d<a.page.totalPages&&b.get({page:d,size:a.pageSize,sort:["id,desc"]},function(b){console.clear(),console.log("turnPage:"),console.log(b),a.page=b,a.totalPagesList=c.setTotalPagesList(b)})},a.saveBrand=function(c,e){console.clear(),console.log("saveBrand:"),console.log(e),b.save({},e,function(b){console.log("saveBrand complete:"),console.log(b),c.$setPristine(),a.brand={},d()})},a.updateBrand=function(a,b){console.clear(),console.log("updateBrand:"),console.log(a),a.editable=!0},a.saveUpdateBrand=function(a,c,d){console.clear(),console.log("saveUpdateBrand complete:"),b.save({},a,function(){console.log(a),a.editable=!1,c.$setPristine()})},a.removingBrand=void 0,a.showRemoveBrand=function(b,c){console.clear(),console.log("showRemoveBrand $index: "+c),console.log(b),a.removingBrand=b,$("#brandDeleteModal").modal("show")},a.removeBrand=function(){console.clear(),console.log("removeBrand:"),console.log(a.removingBrand),angular.isDefined(a.removingBrand)&&b.remove({id:a.removingBrand.id},{},function(){a.removingBrand=void 0,$("#brandDeleteModal").modal("hide"),d()})}}]),angular.module("ecommApp").controller("CategoryController",["$scope","Category","Utils",function(a,b,c){function d(){b.getAll().then(function(a){console.clear(),console.log("cateogries:"),console.log(a)})}a.totalPagesList=[],a.pageSize=20,a.category={},d(),a.turnPage=function(d){d>-1&&d<a.page.totalPages&&b.get({page:d,size:a.pageSize,sort:["id,desc"]},function(b){console.clear(),console.log("turnPage:"),console.log(b),a.page=b,a.totalPagesList=c.setTotalPagesList(b)})},a.saveCategory=function(c,e){console.clear(),console.log("saveCategory:"),console.log(e),b.save({},e,function(b){console.log("saveCategory complete:"),console.log(b),c.$setPristine(),a.category={},d()})},a.updateCategory=function(a,b){console.clear(),console.log("updateCategory:"),console.log(a),a.editable=!0},a.saveUpdateCategory=function(a,c){console.clear(),console.log("saveUpdateCategory complete:"),b.save({},a,function(){console.log(a),a.editable=!1})},a.removingCategory=void 0,a.showRemoveCategory=function(b,c){console.clear(),console.log("showRemoveCategory $index: "+c),console.log(b),a.removingCategory=b,$("#categoryDeleteModal").modal("show")},a.removeCategory=function(){console.clear(),console.log("removeCategory:"),console.log(a.removingCategory),angular.isDefined(a.removingCategory)&&b.remove({id:a.removingCategory.id},{},function(){a.removingCategory=void 0,$("#categoryDeleteModal").modal("hide"),d()})}}]),angular.module("ecommApp").controller("MadeFromController",["$scope","MadeFrom","Utils",function(a,b,c){function d(){b.get({page:0,size:a.pageSize,sort:["id,desc"]},function(b){console.clear(),console.log("page:"),console.log(b),a.page=b,a.totalPagesList=c.setTotalPagesList(b)})}a.totalPagesList=[],a.pageSize=20,a.MadeFrom={},d(),a.turnPage=function(d){d>-1&&d<a.page.totalPages&&b.get({page:d,size:a.pageSize,sort:["id,desc"]},function(b){console.clear(),console.log("turnPage:"),console.log(b),a.page=b,a.totalPagesList=c.setTotalPagesList(b)})},a.saveMadeFrom=function(b,c){console.clear(),console.log("saveMadeFrom:"),console.log(c),c.save({},c,function(c){console.log("saveMadeFrom complete:"),console.log(c),b.$setPristine(),a.MadeFrom={},d()})},a.updateMadeFrom=function(a,b){console.clear(),console.log("updateMadeFrom:"),console.log(a),a.editable=!0},a.saveUpdateMadeFrom=function(a,c){console.clear(),console.log("saveUpdateMadeFrom complete:"),b.save({},a,function(){console.log(a),a.editable=!1})},a.removingMadeFrom=void 0,a.showRemoveMadeFrom=function(b,c){console.clear(),console.log("showRemoveMadeFrom $index: "+c),console.log(b),a.removingMadeFrom=b,$("#MadeFromDeleteModal").modal("show")},a.removeMadeFrom=function(){console.clear(),console.log("removeMadeFrom:"),console.log(a.removingMadeFrom),angular.isDefined(a.removingMadeFrom)&&b.remove({id:a.removingMadeFrom.id},{},function(){a.removingMadeFrom=void 0,$("#MadeFromDeleteModal").modal("hide"),
d()})}}]),angular.module("ecommApp").controller("RoleController",["$rootScope","$scope","Authority","Role",function(a,b,c,d){function e(a){angular.isArray(a)||(a=[a]),angular.forEach(a,function(a){a.authorityString="";for(var b=a.authorities,c=0,d=b.length-1;d>c;c++)a.authorityString+=b[c].name+", ";a.authorityString+=b[b.length-1].name})}function f(a){var c=!1;angular.forEach(b.roles,function(b){return b.id==a.id?(b.authorityString=a.authorityString,console.log(b),void(c=!0)):void 0}),c||b.roles.push(a)}b.reset=function(){b.authoritiesDoneWarning=!1,b.role={},b.userRoleForm&&b.userRoleForm.$setPristine(),angular.forEach(b.authorities,function(a){a.done=!1})},b.reset(),b.roles=null,d.query(function(a){console.log(a),b.roles=a,e(b.roles)}),b.authorities=[],c.query(function(a){b.authorities=a}),b.save=function(){return b.role.authorities=[],angular.forEach(b.authorities,function(a){a.done&&b.role.authorities.push(a)}),0==b.role.authorities.length?(b.authoritiesDoneWarning=!0,!1):(b.authoritiesDoneWarning=!1,void d.save({},b.role,function(a){e(a),f(a),b.reset()},function(a){console.log(a)}))},b.remove=function(a){d.remove({id:a},{},function(c){var d=b.roles;b.roles=[],angular.forEach(d,function(c){c.id!=a&&b.roles.push(c)}),b.reset()},function(a){console.log(a)})},b.select=function(a){b.role=a,angular.forEach(b.authorities,function(a){angular.forEach(b.role.authorities,function(b){return a.id==b.id?void(a.done=!0):void 0})})}}]),angular.module("ecommApp").controller("ShopController",["$rootScope","$scope","Shop","Utils",function(a,b,c,d){b.totalPagesList=[],b.pageSize=20,c.get({page:0,size:b.pageSize},function(a){b.page=a,b.totalPagesList=d.setTotalPagesList(a)}),b.turnPage=function(a){a>-1&&a<b.page.totalPages&&c.get({page:a,size:b.pageSize},function(a){b.page=a,b.totalPagesList=d.setTotalPagesList(a)})}}]).controller("ShopOperatorController",["$rootScope","$scope","$state","$stateParams","User","Language","Currency","Shop",function(a,b,c,d,e,f,g,h){b.users=[],b.languages=[],b.currencies=[],b.types=[{id:0,label:"自营"},{id:1,label:"合作"}],b.statuses=[{id:0,label:"禁用"},{id:1,label:"正常"}],b.lvls=[{id:0,label:"Level 0"},{id:1,label:"Level 1"},{id:2,label:"Level 2"},{id:3,label:"Level 3"},{id:4,label:"Level 4"},{id:5,label:"Level 5"},{id:6,label:"Level 6"},{id:7,label:"Level 7"},{id:8,label:"Level 8"},{id:9,label:"Level 9"},{id:10,label:"Level 10"}],b.shop={type:0,status:1,apiCallLimit:-1,language:{id:100},currency:{id:101},priceLevel:0},b.action="create",e.getAll().then(function(a){console.log("users loaded"),b.users=a}).then(function(){return f.getAll().then(function(a){b.languages=a,console.log("languaegs loaded")})}).then(function(){return g.getAll().then(function(a){b.currencies=a,console.log("currencies loaded")})}).then(function(){console.log("selected user loaded"),d.id&&""!=d.id&&(b.action="update",h.get({id:d.id},{},function(a){b.shop=a,console.log(a)}))}),b.save=function(a){console.log(a),h.save({},a,function(a){c.go("shop")},function(a){console.log(a)})},b.remove=function(){h.remove({id:d.id},{},function(a){c.go("shop")},function(a){console.log(a)})}}]),angular.module("ecommApp").controller("UserController",["$rootScope","$scope","User","Role","Authority",function(a,b,c,d,e){function f(a){angular.isArray(a)||(a=[a]),angular.forEach(a,function(a){a.roleString="";for(var b=a.roles,c=0,d=b.length-1;d>c;c++)a.roleString+=b[c].name+", ";a.roleString+=b[b.length-1].name})}b.totalPagesList=[],c.get({page:0,size:20},function(a){if(console.log(a),b.page=a,f(b.page.content),a.totalPages>0)for(var c=0,d=a.totalPages;d>c;c++)b.totalPagesList.push(c)}),b.turnPage=function(a){console.log(a),a>-1&&a<b.page.totalPages&&c.get({page:a,size:5},function(a){b.page=a,f(b.page.content)})}}]).controller("UserOperatorController",["$rootScope","$scope","$state","$stateParams","$q","User","Role",function(a,b,c,d,e,f,g){b.user={},b.roles={},b.action="create";var h="";g.query().$promise.then(function(a){b.roles=a}).then(function(){d.id&&""!=d.id&&(b.action="update",f.get({id:d.id},{},function(a){h=a.password,a.password="********",b.user=a,angular.forEach(b.roles,function(a){angular.forEach(b.user.roles,function(b){return a.id==b.id?void(a.done=!0):void 0})})},function(a){console.log(a)}))}),b.save=function(a){return b.user.roles=[],angular.forEach(b.roles,function(a){a.done&&b.user.roles.push(a)}),0==b.user.roles.length?(b.rolesDoneWarning=!0,!1):(b.rolesDoneWarning=!1,"update"==b.action&&"********"==b.user.password&&(b.user.password=h),void f.save({},a,function(a){c.go("user")},function(a){console.log(a)}))},b.remove=function(){f.remove({id:d.id},{},function(a){c.go("user")},function(a){console.log(a)})},b.clean=function(){"update"==b.action&&(b.user.password="")}}]),angular.module("ecommApp").factory("Inventory",["$resource","$http",function(a,b){var c=a("/api/inventories/:id");c.getAll=function(){return b.get("/api/inventories/get/all").then(function(a){return a.data})},c.getAllByWarehouseId=function(a){return b.get("/api/inventories/get/all/"+a).then(function(a){return a.data})},c.refresh=function(a){var b=[];return angular.forEach(a,function(a){var c=!1;angular.forEach(b,function(b){if(b.sku==a.product.sku){if(a.position){var d=!1;angular.forEach(b.positions,function(b){if(b.id==a.position.id){var c=!1;return angular.forEach(b.batches,function(b){return b.id==a.inventoryBatchId?(b.total+=a.quantity,void(c=!0)):void 0}),c||b.batches.push({id:a.inventoryBatchId,total:a.quantity}),b.total+=a.quantity,void(d=!0)}}),d||(a.position.total=a.quantity,a.position.batches=[{id:a.inventoryBatchId,total:a.quantity}],b.positions.push(a.position)),b.existPosition=!0}else{var e=!1;angular.forEach(b.batches,function(b){return b.id==a.inventoryBatchId?(b.total+=a.quantity,void(e=!0)):void 0}),e||b.batches.push({id:a.inventoryBatchId,total:a.quantity})}var f={position:a.position,quantity:a.quantity,expireDate:a.expireDate,batchId:a.inventoryBatchId};return b.total+=a.quantity,b.details.push(f),void(c=!0)}}),c||(a.product.positions=[],a.position?(a.position.total=a.quantity,a.position.batches=[{id:a.inventoryBatchId,total:a.quantity}],a.product.positions.push(a.position),a.product.existPosition=!0):a.product.batches=[{id:a.inventoryBatchId,total:a.quantity}],a.product.details=[{position:a.position,quantity:a.quantity,expireDate:a.expireDate,batchId:a.inventoryBatchId}],a.product.total=a.quantity,b.push(a.product))}),b};var d=function(a,b,c){for(var d=0,e=a.batches.length;e>d;d++){var f=a.batches[d];if(f.id==b.outBatch.id){"add"==c?(f.total-=b.changedQuantity,a.total-=b.changedQuantity):"remove"==c&&(f.total+=b.changedQuantity,a.total+=b.changedQuantity);break}}return a},e=function(a,b,c){if("add"==c){a.total-=b.changedQuantity;for(var d=b.changedQuantity,e=0,f=a.batches.length;f>e;e++){var g=a.batches[e];if(!(g.total-d<0)){g[b.$index]=d,g.total-=d;break}g[b.$index]=g.total,d-=g.total,g.total=0}}else if("remove"==c){a.total+=b.changedQuantity;for(var e=0,f=a.batches.length;f>e;e++){var g=a.batches[e];g.total+=void 0!==g[b.$index]&&g[b.$index]}}return a},f=function(a,b,c){for(var f=0,g=a.positions.length;g>f;f++)if(a.positions[f].id==b.position.id){b.outBatch?(console.log("item有批次"),a.positions[f]=d(a.positions[f],b,c)):(console.log("item没批次"),a.positions[f]=e(a.positions[f],b,c)),console.log(a.positions[f]);break}return a};return c.refrechProducts=function(a,b,c){for(var g=0,h=a.length;h>g;g++)if(a[g].sku==b.product.sku){console.log("匹配到商品"),b.position?(console.log("item有库位"),a[g]=f(a[g],b,c),console.log(a[g])):(console.log("item没库位"),b.outBatch?(console.log("item有批次"),a[g]=d(a[g],b,c)):(console.log("item没批次"),a[g]=e(a[g],b,c)));break}return a},c}]).factory("InventoryBatch",["$resource","$http",function(a,b){var c=a("/api/inventorybatches/:id");return c.getAll=function(){return b.get("/api/inventorybatches/get/all").then(function(a){return a.data})},c}]),angular.module("ecommApp").factory("Warehouse",["$resource","$http",function(a,b){var c=a("/api/warehouses/:id",{},{});return c.getAll=function(){return b.get("/api/warehouses/get/all").then(function(a){return a.data})},c.savePositions=function(a){return b.post("/api/warehousepositions/save/list",a).then(function(a){return a.data})},c}]),angular.module("ecommApp").factory("Process",["$resource","$http",function(a,b){var c=a("/api/processes/:id");return c.getAll=function(a){return b.get("/api/processes/get/all",{params:a}).then(function(a){return a.data})},c}]).factory("ProcessStep",["$resource","$http",function(a,b){var c=a("/api/processsteps/:id");return c.getAll=function(){return b.get("/api/processsteps/get/all").then(function(a){return a.data})},c.refresh=function(a){return $.each(a,function(a){this.sequence=a}),a},c}]).factory("ObjectProcess",["$resource","$http",function(a,b){var c=a("/api/objectprocesses/:id");return c.getAll=function(a){return b.get("/api/objectprocesses/get/all",{params:a}).then(function(a){return a.data})},c}]),angular.module("ecommApp").factory("Brand",["$resource","$http",function(a,b){var c=a("/api/brands/:id",{},{});return c.getAll=function(){return b.get("/api/brands/get/all").then(function(a){return a.data})},c}]),angular.module("ecommApp").factory("Category",["$resource","$http",function(a,b){var c=a("/api/categories/:id",{},{});return c.getAll=function(){return b.get("/api/categories/get/all").then(function(a){return a.data})},c}]),angular.module("ecommApp").factory("MadeFrom",["$resource","$http",function(a,b){var c=a("/api/madefroms/:id",{},{});return c.getAll=function(){return b.get("/api/madefroms/get/all").then(function(a){return a.data})},c}]),angular.module("ecommApp").factory("Product",["$resource","$http",function(a,b){var c=a("/api/products/:id",{},{});return c.getAll=function(a){return b.get("/api/products/get/all",{params:a}).then(function(a){return a.data})},c}]).factory("ProductMultiLanguage",["$resource",function(a){var b=a("/api/productmultilanguages/:id",{},{});return b}]).factory("ProductMultiCurrency",["$resource",function(a){var b=a("/api/productmulticurrencies/:id",{},{});return b}]).factory("ProductMember",["$resource",function(a){var b=a("/api/productmembers/:id",{},{});return b}]),angular.module("ecommApp").factory("Tag",["$resource","$http",function(a,b){var c=a("/api/tags/:id");return c.getAll=function(){return b.get("/api/tags/get/all").then(function(a){return a.data})},c}]),angular.module("ecommApp").factory("Currency",["$resource","$http",function(a,b){var c=a("/api/currencies/:id");return c.getAll=function(){return b.get("/api/currencies/get/all").then(function(a){return a.data})},c}]),angular.module("ecommApp").factory("Language",["$resource","$http",function(a,b){var c=a("/api/languages/:id");return c.getAll=function(){return b.get("/api/languages/get/all").then(function(a){return a.data})},c}]),angular.module("ecommApp").factory("Role",["$resource",function(a){return a("/api/roles/:id",{},{})}]),angular.module("ecommApp").factory("Shop",["$resource",function(a){return a("/api/shops/:id",{},{})}]),angular.module("ecommApp").factory("User",["$resource","$http",function(a,b){var c=a("/api/users/:id",{},{});return c.getAll=function(){return b.get("/api/users/get/all").then(function(a){return a.data})},c}]),angular.module("ecommApp").factory("Account",["$resource",function(a){return a("api/account",{},{})}]),angular.module("ecommApp").factory("Auth",["$rootScope","$http","$state","Account","Principal","localStorageService",function(a,b,c,d,e,f){return{login:function(a){var c="j_username="+a.username+"&j_password="+a.password;return b.post("/api/authenticate",c,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(){e.identify(!0).then(function(a){})}).error(function(){})},logout:function(){return b.post("/api/logout").success(function(){e.authenticate(null),f.clearAll(),b.get("/api/csrf")})},identify:function(b){return e.identify(b).then(function(){var b=e.isAuthenticated();a.toState.data.roles&&a.toState.data.roles.length>0&&!e.isInAnyRole(a.toState.data.roles)&&(b?c.go("accessdenied"):(a.returnToState=a.toState,a.returnToStateParams=a.toStateParams,c.go("login")))})}}}]),angular.module("ecommApp").factory("Authority",["$resource",function(a){return a("/api/authorities/:id",{},{})}]),angular.module("ecommApp").factory("Principal",["$q","Account",function(a,b){var c,d=!1,e=[],f=[];return{get:function(){return c},isResolved:function(){return angular.isDefined(c)},isAuthenticated:function(){return d},isInRole:function(a){return d&&c&&c.roles?-1!==f.indexOf(a):!1},isInAnyRole:function(a){if(!d||!c.roles)return!1;for(var b=0;b<a.length;b++)if(this.isInRole(a[b]))return!0;return!1},authenticate:function(a){c=a,d=null!==a},identify:function(g){var h=a.defer();g===!0&&(c=void 0);var i=angular.isDefined(c);return i?(h.resolve(c),h.promise):(b.get().$promise.then(function(a){c=a,d=!0,angular.forEach(a.roles,function(a){f.push(a.name),angular.forEach(a.authorities,function(a){e.push(a.name)})}),h.resolve(c)})["catch"](function(){c=null,d=!1,h.resolve(c)}),h.promise)}}}]),angular.module("ecommApp").factory("Utils",["$q",function(a){return{setTotalPagesList:function(a){var b=[];if(a.totalPages>0)for(var c=0,d=a.totalPages;d>c;c++)b.push(c);return b},convertLocaleDateToServer:function(a){if(a){var b=new Date;return b.setUTCDate(a.getDate()),b.setUTCMonth(a.getMonth()),b.setUTCFullYear(a.getFullYear()),b}return null},convertLocaleDateFromServer:function(a){if(a){var b=a.split("-");return new Date(b[0],b[1]-1,b[2])}return null},convertDateTimeFromServer:function(a){return a?new Date(a):null}}}]),angular.module("ecommApp").factory("Resource",["$resource","$http",function(a,b){return{getResource:function(){return b.get("/api/resource").then(function(a){return a.data})}}}]),angular.module("ecommApp").directive("ensureUnique",["$timeout","$http",function(a,b){return{require:"ngModel",link:function(c,d,e,f){var g,h;c.$watch(e.ngModel,function(c){c&&(g&&a.cancel(g),g=a(function(){h=""!==e.checkId?e.ensureUnique+c+"/"+e.checkId:e.ensureUnique+c,b.get(h).success(function(a){f.$setValidity("unique",!a)}).error(function(a){f.$setValidity("unique",!1)})},350))})}}}]),angular.module("ecommApp").directive("focusMe",["$timeout",function(a){return{scope:{trigger:"@focusMe"},link:function(a,b,c){a.$watch("trigger",function(a){"true"===a&&setTimeout(function(){b[0].focus()},50)})}}}]);